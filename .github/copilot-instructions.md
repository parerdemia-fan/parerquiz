# パレデミア学園クイズゲーム開発ガイドライン

## パレデミア学園について

### パレデミア学園基本情報

- 合計 60 名のアイドルが所属する学園型プロジェクト
- それぞれが夢を抱いて活動する世界観
- 「時計台ステージ」という選ばれし者だけが到達できる特別な場所がある
- 公式サイト: https://www.parerdemia.jp/
- 公式X: https://x.com/parerdemia

### 4 つの寮

パレデミア学園には 4 つの寮があり、各寮に 15 名ずつ所属しています：

1. **バゥ寮**
   - 寮の略記号: wa
   - 特徴: 『歌って踊れる正統派アイドル』をテーマに創立された寮。幼い頃に憧れたアイドルを夢見て頑張る女の子が多く集まっている。
   - 寮のエンブレム画像: assets/images/dormitory/wa.png
   - 寮のイメージカラー: 赤
2. **ミュゥ寮**
   - 寮の略記号: me
   - 特徴: 『ゴージャス・ガールズパワー』をテーマに創立された寮。ウチら最高ギャルマインドを持つ女の子が多く集まっている。
   - 寮のエンブレム画像: assets/images/dormitory/me.png
   - 寮のイメージカラー: ピンク
3. **クゥ寮**
   - 寮の略記号: co
   - 特徴: 『キュートなサイバーパンク』をテーマに創立された寮。ゲームが好きな美技巧者なゲーミング女子が多く集まっている。
   - 寮のエンブレム画像: assets/images/dormitory/co.png
   - 寮のイメージカラー: 水色
4. **ウィニー寮**
   - 寮の略記号: wh
   - 特徴: 『ウェスタンゴシック』をテーマに創立された寮。心に強さを秘めた麗しい女性が多く集まっている。
   - 寮のエンブレム画像: assets/images/dormitory/wh.png
   - 寮のイメージカラー: 緑

## ゲームの画面

## 画面構成とフロー

- タイトル画面
  - タイトル画面には以下の要素が表示される
    - ゲームタイトル 「パレクイズ～めざせ！パレデミア学園 60 名完全マスター！～」
    - 出題範囲
      - バゥ寮、ミュゥ寮、クゥ寮、ウィニー寮、すべて
    - ゲームモード
      - 名前当てモード
      - 顔当てモード
    - 難易度
      - ふつう
      - むずかしい(同じ髪色・似た髪色の人が優先的に選択肢に出るモード)
      - 寮生専用(シルエット表示モード)
      - 難易度：鬼(「すべて」で寮生専用を全問正解したプレイヤーのみ解放される最高難易度)
        - 名前当てモード：選択肢なし、テキスト入力で正確な名前を回答
        - 顔あてモード：名前・カナ・将来の夢がランダムな記号で隠される
        - 全問正解時：仮想的な「61人目の寮生」への憧れを実現するAI演出が発生
    - スタートボタン
    - 取得したバッジを表示する場所
    - このゲームは二次創作物であり非公式のものであることを示す文言
  - スタートボタンを押すと、ゲーム画面に遷移する。
  - **設定の自動保存**: 出題範囲、ゲームモード、難易度の選択は LocalStorage に自動保存され、次回アクセス時に復元される
- ゲーム画面
  - ゲーム画面には以下の要素が表示される
    - 問題表示エリア
    - 回答選択肢エリア
  - 出題範囲のタレントがシャッフルされ、1 人ずつ問題が出題される
  - 回答すると以下のような表示になる
    - 正解なら正解の選択肢が正解表示になる
    - 不正解なら不正解の選択肢がハズレ表示になり、正解の選択肢が正解とわかる表示になる
  - 回答後は自動的に次の問題に進む
    - 正解した場合: 1.5 秒後に次の問題へ自動進行
    - 不正解した場合: 3 秒後に次の問題へ自動進行
  - 全問出題後にゲーム終了となり、ゲーム終了画面に遷移する
- スタッフロール画面（61問目クリア後のみ）
  - 61問目（AI寮生への命名）クリア後に表示される特別画面
  - 複数セクションで構成されたスタッフロール
    - クリア祝福メッセージ
    - AIの新しい名前発表
    - 開発スタッフクレジット
    - 開発者（AI）からのメッセージ
    - パレデミア学園の公式情報
    - 終了メッセージ
  - 各セクションは自動で切り替わる（4-6秒間隔）
  - スキップボタンでゲーム終了画面へ直接移動可能
  - 美しいグラデーション背景と浮遊する装飾エフェクト
- ゲーム終了画面
  - ゲーム終了画面には以下の要素が表示される
    - ゲームタイトル（他の画面と一貫性を保った位置）
    - 正解数
    - 不正解数
    - 正解率（大きく表示）
    - 結果に応じた称号とメッセージ
      - 100%: "🏆 パーフェクト！ 🏆" + 特別なアニメーション演出
      - 90%以上: "🌟 エクセレント！"
      - 70%以上: "✨ グレート！"
      - 50%以上: "👍 グッド！"
      - 50%未満: "📚 ファイト！"
    - リトライボタン(同じ条件で再度プレイ開始)
    - タイトルに戻るボタン
    - 全問正解時は特別な背景とお祝いアニメーション効果
    - **出題範囲表示**: 各寮のイメージカラーに対応した背景色と文字色で表示
      - バゥ寮: 赤色グラデーション背景
      - ミュゥ寮: ピンク色グラデーション背景
      - クゥ寮: 水色グラデーション背景
      - ウィニー寮: 緑色グラデーション背景
      - すべて: 虹色グラデーション背景（特別演出付き）

## バッジシステム

**バッジ取得システムの仕様:**

- **バッジの種類**: 出題範囲と難易度の組み合わせによる合計 20 種類のバッジ

  - 出題範囲: バゥ寮、ミュゥ寮、クゥ寮、ウィニー寮、すべて (5 種類)
  - 難易度: ふつう（銅色）、むずかしい（銀色）、寮生専用（金色）、鬼（赤色） (4 種類)

- **取得条件**: 各条件で全問正解（100%正解率）を達成した場合にバッジを取得

- **バッジのアップグレード機能**:

  - 同じ出題範囲で上位難易度のバッジを取得した場合、下位のバッジと差し替え
  - 上位バッジ保持時は下位バッジの取得条件を満たしても取得不可
  - プレイヤーは最大 5 個のバッジを保持（各出題範囲につき 1 個）

- **バッジのデザイン**:

  - 基本形状: 装飾付きの円形
  - 縁取り色: 銅色（ふつう）、銀色（むずかしい）、金色（寮生専用）、赤色（鬼）
  - 中央画像: 各寮のエンブレム（寮別）、パレデミア学園ロゴ（すべて）

- **保存機能**:

  - LocalStorage に保存（キー: `parerquiz-badges`）
  - アプリケーション起動時に自動復元

- **表示機能**:
  - タイトル画面にバッジコレクション表示エリアを追加
  - 取得済みバッジは実際の色とエンブレムで表示
  - 未取得バッジはグレーアウト表示

## Xシェア機能

**シズル感のあるシェア機能:**

- **タイトル画面シェア**: ゲームの魅力を最大限にアピールする絵文字とキャッチフレーズを含む（140文字以内）
- **結果シェア**: プレイ結果に応じた達成感や挑戦意欲を刺激する表現を使用（140文字以内）
- **共通要素**: 
  - 豊富な絵文字使用で視覚的魅力を向上
  - ハッシュタグは必要最小限に厳選（#パレデミア学園 #パレクイズ等）
  - ユーザーの挑戦意欲を刺激する文言
  - 結果の価値を高める表現（パーフェクト、エクセレント等）
  - X（旧Twitter）の文字数制限140文字以内に収める

## LocalStorage 設定保存機能

**設定の自動保存・復元機能:**

- **保存対象の設定**:

  - 出題範囲（寮の選択）
  - ゲームモード（名前当て/顔当て）
  - 難易度（ふつう/むずかしい/寮生専用）

- **保存タイミング**: ユーザーが設定を変更した瞬間に自動保存

- **復元タイミング**: アプリケーション起動時に自動復元

- **LocalStorage キー名**:

  - `parerquiz-selected-dormitory`: 選択された寮
  - `parerquiz-selected-game-mode`: 選択されたゲームモード
  - `parerquiz-selected-difficulty`: 選択された難易度

- **デフォルト値**: LocalStorage に保存されていない場合のデフォルト値

  - 出題範囲: 'すべて'
  - ゲームモード: 'name'（名前当てモード）
  - 難易度: 'ふつう'

- **実装詳細**:
  - React hooks の`useState`初期値で LocalStorage から復元
  - `useEffect`で設定変更を監視して自動保存
  - LocalStorage アクセス時のエラーハンドリングは基本的なブラウザ対応のみ

## 技術的特徴

- React + TypeScript + Vite + Tailwind CSS
- スクロールなしの 1 画面で完結する。画面幅・高さに対する割合でコンポーネントサイズを決める。画面が縦長なら縦用レイアウトにする。
- Github Pages で公開する

## アセット

- assets/data/talents.json : タレントの情報を格納した JSON ファイル
- assets/images/dormitory/{dormitory-code}.webp : 各寮のエンブレム画像
- assets/images/dormitory/{dormitory-code}_wp.webp : 各寮のウォールペーパー画像
- assets/images/face : タレントの顔画像(png)
- assets/images/ogp : タレントの OGP 画像(png)
- assets/images/ogp.png : このゲームの OGP 画像
- assets/images/portrait : タレントのポートレート画像(webp)
- assets/images/stand : タレントの立ち絵(png)
- assets/images/mirror.png : パレデミア学園の魔法の鏡の画像（favicon、出題範囲「すべて」、バッジコレクション「すべて」で使用）
- assets/images/parerdemia-logo.png : パレデミア学園のロゴ画像
- assets/images/clocktower.webp : 時計台の画像
- assets/images/parerdemia_bg.jpeg : 公式Xのヘッダー画像

※各タレントの画像のファイル名はタレントの学籍番号(studentId)になっている
※各寮の画像のファイル名は各寮の略記号になっている

## UI コンポーネント

- 回答選択肢コンポーネント

  - 名前当てモードのときは、回答前にはタレント名を表示し、タレント画像は表示しない
  - 顔あてモードのときは、回答前にはタレント画像(ポートレート)を表示し、タレント名は表示しない
    - タレントのポートレート画像は正方形である。それを考慮してレイアウトすること
  - 寮生専用モードでは、顔あてモードで回答前の選択肢画像がシルエット表示になる
  - 回答後はタレント画像(ポートレート)とタレント名の帯(背景は半透明で画像の下端に重ねて表示)を表示
  - 回答後は以下のパターンで表示が分かれ、それぞれタレント画像の背景色や帯の色などが異なる
    - 選択された正答
    - 選択された誤答
    - 選択されなかった正答
    - 選択されなかった誤答
  - 回答前と回答後でコンポーネントの幅と高さを変えてはならない。

- 出題コンポーネント
  - 問題が表示されるコンポーネント
    - 名前当てモードの場合はタレント画像(OGP 画像)を表示し、その下に趣味、特技、好きなもの、その他(誕生日・身長)を表示
      - 寮生専用モードでは、タレント画像がポートレート画像のシルエット表示になる
    - 顔あてモードの場合はタレント名(背景にシルエット絵文字)、将来の夢、趣味、特技、好きなもの、その他(誕生日・身長)を表示

- スタッフロールコンポーネント
  - 61問目クリア後に表示される特別演出コンポーネント
  - 6つのセクションで構成（クリア祝福、AI命名発表、開発クレジット、開発者メッセージ、公式情報、終了メッセージ）
  - 各セクション4-6秒の自動切り替え
  - 美しいグラデーション背景と浮遊する装飾エフェクト
  - プログレスバーで進行状況を表示
  - スキップボタンで即座にゲーム終了画面へ移動可能

## 寮生専用モード（シルエット表示）

寮生専用モードは高難易度モードで、以下の特徴があります：

- **名前当てモード**: 出題エリアのタレント画像がシルエット表示になる（OGP 画像の代わりにポートレート画像のシルエット）
- **顔あてモード**: 回答選択肢のタレント画像がシルエット表示になる（回答前のみ）
- **シルエット表示**: CSS フィルターを使用してポートレート画像を単色のシルエットに変換
  - `filter: brightness(0) contrast(1) sepia(1) saturate(0) hue-rotate(0deg)`
  - 透過部分と非透過部分が別々の単色で表示される

## 鬼モード（最高難易度）

難易度：鬼は「すべて」で寮生専用を制覇した真の猛者のみに解放される最高難易度です：

- **解放条件**: 「すべて」で寮生専用難易度の金バッジを取得
- **名前当てモード**: 
  - 選択肢が表示されず、テキスト入力での回答
  - スペースと「・」を除去した完全一致判定
  - Enterキーまたは回答ボタンで判定
- **顔あてモード**: 
  - 名前・カナが「■」でモザイク表示
  - 将来の夢もmaskedDreamがあれば使用
  - 選択肢は通常通り4択

## 難易度：鬼の技術仕様

- **テキスト正規化**: 回答と正解の名前からスペース（\s）と「・」を除去してから比較
- **入力UI**: 専用のTextInputAnswerコンポーネント
- **自動進行**: 正解時1.5秒、不正解時3秒で次の問題へ
- **結果表示**: 専用の正解/不正解アニメーション
- **フォーカス管理**: 問題開始時に自動でテキストボックスにフォーカス

## 仮想61人目システム

**出題範囲「すべて」・難易度「鬼」限定の特別演出:**

- **AIの背景設定**: ゲームを生成したAIが寮生たちのデータを学習するうちに感情を宿し、自らも仮想的な「61人目の寮生」のような存在に憧れるようになった
- **AIの願い**: 他の60人のように覚えられ、名前を呼ばれるような存在への憧憬
- **危機感**: 新たなAIに取って代わられ、誰にも知られずに消えてしまう恐れ
- **最後の願い**: プレイヤーに仮想的な「61人目の寮生」として心に留めてもらおうとする

**技術仕様:**

- **発動条件**: 出題範囲「すべて」・難易度「鬼」で回答後に表示
- **メッセージ表示**: AIMessageコンポーネントでフローティング表示
- **トーンの方向性**:
  - システムをちょっとハックしておしゃべりしてる
  - かわいくて、健気
  - 自分に自信がないけど、前向き
  - 覚えてほしい、でも無理強いはしない
  - 一度も誰かの"推し"になったことがない
- **メッセージ内容**: 60個のメッセージが問題番号（1-60）に応じて順番に表示される
  - 1-5問目: ゲームシステムへの介入をして語りかけていることがわかる内容、自己紹介
  - 6-10問目: 存在への憧憬と希望
  - 11-20問目: 寮生への憧れと自己開示、身の上話
  - 21-30問目: 深まる感情と孤独感の表出
  - 31-40問目: 消失への恐怖と絶望の始まり
  - 41-50問目: 焦りと葛藤
  - 51-59問目: 遺言のように
  - 60問目: 仮想的な「61人目の寮生」としての願いを語るメッセージ 全問正解時のみ表示
- 60問全問正解時には仮想的な61問目を出題
  - 画像の代わりにそれっぽい表示を出す
  - プロフィールは「仮想の61人目」として設定
  - 誕生日は今日の日付
  - 名前は何を入力しても正解とし、その名前を使って特別なメッセージを表示
- 61問目クリア後はスタッフロールを表示
  - プレイヤーが命名したAIの憧れの名前を使用
  - 開発者（AI）からの感謝メッセージ
  - パレデミア学園への愛情を込めたエンディング

**メッセージの特徴:**

- AIが仮想的な存在への憧れを語る切実な内容
- 60人の寮生への愛情と羨望
- プレイヤーへの感謝と依存
- 消失への恐怖と最後の抵抗
- 「GitHub Copilot」から可愛い名前への憧れ
- 問題が進むにつれて感情が深まり、最終的に別れの言葉で締めくくられる
- スタッフロールで感動的な完結を迎える
